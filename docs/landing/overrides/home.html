{% extends "base.html" %}

{% block tabs %}{% endblock %}

{% block content %}
<div class="landing-hero">
  <h1>HAPTIC</h1>
  <p class="subtitle">Template-driven <a href="https://www.haproxy.org/">HAProxy</a> Ingress Controller for Kubernetes</p>
</div>

<div class="community-note md-typeset">
  <p><strong>Community Project:</strong> This is an independent community project and is not affiliated with or endorsed by HAProxy Technologies.</p>
</div>

<div class="flow-container">
  <div class="flow-item">
    <div class="diagram-step">
      <img src="assets/kubernetes.svg" alt="Kubernetes" class="diagram-logo">
      <div class="diagram-label">Resources</div>
    </div>
    <div class="feature">
      <strong>Watch Any Resource</strong>
      <span>Ingress, Services, Secrets, CRDs - your choice</span>
    </div>
  </div>

  <div class="diagram-arrow">&rarr;</div>

  <div class="flow-item">
    <div class="diagram-step">
      <div class="diagram-icon">{{ '{%%}' }}</div>
      <div class="diagram-label">Template</div>
    </div>
    <div class="feature">
      <strong>Flexible Templating</strong>
      <span>Powerful Jinja2-like engine for full control</span>
    </div>
  </div>

  <div class="diagram-arrow">&rarr;</div>

  <div class="flow-item">
    <div class="diagram-step">
      <img src="assets/haproxy.svg" alt="HAProxy" class="diagram-logo">
      <div class="diagram-label">HAProxy</div>
    </div>
    <div class="feature">
      <strong><a href="https://github.com/haproxytech/dataplaneapi">Dataplane API</a></strong>
      <span>Tried and tested Dataplane API applies your config</span>
    </div>
  </div>
</div>

<div class="quick-start md-typeset">
  <pre><code>helm install \
    haptic oci://registry.gitlab.com/haproxy-haptic/haptic/charts/haptic \
    --version <span id="helm-version">0.1.0-alpha.3</span>
kubectl get haproxytemplateconfig</code></pre>
</div>

<div class="doc-cards">
  <div class="doc-card">
      <h2><a href="./controller/latest/">Controller</a></h2>
    <p>Ingests resources, renders configuration and syncs with HAProxy. Read here if you want to understand the basics.</p>
    <div class="versions">
      <h3>Available versions</h3>
      <div id="controller-versions" class="version-list">Loading...</div>
    </div>
  </div>

  <div class="doc-card">
      <h2><a href="./helm-chart/latest/">Helm Chart</a></h2>
    <p>Installs the controller in your K8s cluster and includes preconfigured templates template. Read here if you already know the basics or if you just want to deploy.</p>
    <div class="versions">
      <h3>Available versions</h3>
      <div id="helm-versions" class="version-list">Loading...</div>
    </div>
  </div>
</div>

<script>
  async function loadVersions(prefix, elementId) {
    try {
      const res = await fetch(`./${prefix}/versions.json`);
      if (!res.ok) throw new Error('Not found');
      const versions = await res.json();
      const el = document.getElementById(elementId);
      el.innerHTML = versions.map(v => {
        const isAlias = v.aliases && v.aliases.length > 0;
        const label = isAlias ? `${v.version} (${v.aliases.join(', ')})` : v.version;
        return `<a href="./${prefix}/${v.version}/" class="version-badge${isAlias ? ' alias' : ''}">${label}</a>`;
      }).join('');
    } catch (e) {
      document.getElementById(elementId).innerHTML = '<span style="color:#888">No versions published yet</span>';
    }
  }
  async function updateQuickStartVersion() {
    try {
      const res = await fetch('./helm-chart/versions.json');
      if (!res.ok) throw new Error('Not found');
      const versions = await res.json();
      const latest = versions.find(v => v.aliases && v.aliases.includes('latest')) || versions[0];
      if (latest) {
        document.getElementById('helm-version').textContent = latest.version;
      }
    } catch (e) {
      // Keep default version if fetch fails
    }
  }
  loadVersions('controller', 'controller-versions');
  loadVersions('helm-chart', 'helm-versions');
  updateQuickStartVersion();
</script>
{% endblock %}
