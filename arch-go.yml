version: 1

threshold:
  compliance: 100
  coverage: 100

dependenciesRules:
  # Rule 1: Only controller packages can depend on other top-level packages
  - package: "**.pkg.controller.**"
    shouldOnlyDependsOn:
      internal:
        - "**.pkg.compression.**"  # Decompression for CRD content
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.lifecycle.**"    # Component lifecycle management
        - "**.pkg.metrics.**"
        - "**.pkg.stores.**"       # Store provider abstractions
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"
        - "**.pkg.apis.**"         # CRD API types
        - "**.pkg.generated.**"    # Generated Kubernetes clients
        - "**.codegen.**"

  # Rule 2: core packages should NOT depend on other top-level packages
  - package: "**.pkg.core.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 3: dataplane packages should NOT depend on other top-level packages
  - package: "**.pkg.dataplane.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 4: events package should NOT depend on other top-level packages
  - package: "**.pkg.events.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 5: introspection package should NOT depend on other top-level packages (pure infrastructure)
  - package: "**.pkg.introspection.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 6: k8s packages should NOT depend on other top-level packages (except configpublisher)
  - package: "**.pkg.k8s.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 7: templating package should NOT depend on other top-level packages
  - package: "**.pkg.templating.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.webhook.**"

  # Rule 8: cmd packages can depend on all internal packages (composition root)
  - package: "**.cmd.**"
    shouldOnlyDependsOn:
      internal:
        - "**.cmd.**"
        - "**.pkg.**"
        - "**.codegen.**"

  # Rule 9: codegen packages should NOT depend on internal packages (generated code)
  - package: "**.codegen.**"
    shouldNotDependsOn:
      internal:
        - "**.cmd.**"
        - "**.pkg.**"
        - "**.tests.**"

  # Rule 10: tests packages can depend on all internal packages
  - package: "**.tests.**"
    shouldOnlyDependsOn:
      internal:
        - "**.tests.**"
        - "**.cmd.**"
        - "**.pkg.**"
        - "**.codegen.**"

  # Rule 11: examples packages can depend on all internal packages (demonstration code)
  - package: "**.examples.**"
    shouldOnlyDependsOn:
      internal:
        - "**.examples.**"
        - "**.pkg.**"
        - "**.codegen.**"

  # Rule 12: metrics package should NOT depend on other top-level packages (pure library)
  - package: "**.pkg.metrics.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 13: httpstore package should NOT depend on other top-level packages (pure library)
  - package: "**.pkg.httpstore.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 14: webhook package should NOT depend on other top-level packages (pure library)
  - package: "**.pkg.webhook.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"

  # Rule 15: apis package should NOT depend on other top-level packages (CRD types)
  - package: "**.pkg.apis.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 16: generated package should NOT depend on other top-level packages (generated code)
  - package: "**.pkg.generated.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 17: dataplane/discovery is part of dataplane (already covered by rule 3)
  - package: "**.pkg.dataplane.discovery.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 18: dataplane/types is part of dataplane (already covered by rule 3)
  - package: "**.pkg.dataplane.types.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 19: lifecycle package should NOT depend on other top-level packages (pure infrastructure)
  - package: "**.pkg.lifecycle.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 20: compression package should NOT depend on other top-level packages (pure library)
  - package: "**.pkg.compression.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.lifecycle.**"
        - "**.pkg.metrics.**"
        - "**.pkg.stores.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"

  # Rule 21: stores package should NOT depend on any internal packages (pure library)
  - package: "**.pkg.stores.**"
    shouldNotDependsOn:
      internal:
        - "**.pkg.controller.**"
        - "**.pkg.core.**"
        - "**.pkg.dataplane.**"
        - "**.pkg.events.**"
        - "**.pkg.httpstore.**"
        - "**.pkg.introspection.**"
        - "**.pkg.k8s.**"
        - "**.pkg.lifecycle.**"
        - "**.pkg.metrics.**"
        - "**.pkg.templating.**"
        - "**.pkg.webhook.**"
